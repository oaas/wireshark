##包分析或抓包
分析数据包可以帮我们做什么？ 

1. 理解网络特性，帮助我们更容易的学习网络
2. 知道谁在使用网络，并通过网络做了什么
3. 识别攻击性的行为
4. 找到不安全的，臃肿的应用
5. 总之，一切皆网络.....

常用的包嗅探器:

* Tcpdump
* OmniPeek
* Wireshark

这些抓包工具是怎么去抓包的呢？

1. 首先，包嗅探器从网络接口收集二进制数据，通常是将网络切口切换到混杂模式，在这个模式下，网卡可以接受所有经过它的数据流，而不论其目的地址是否是它；
2. 将收集到的二进制数据包转换为可读的格式,典型的命令行抓包工具只能做到这里；
3. 最后，包嗅探器将可读的格式的数据进行分析，然后通过GUI展示出来，比如Wireshark和OmniPeek;

>混杂模式： 默认情况下，为了更加高效的工作，设备的网卡会检查到达自身的数据包，如果不是自己的，就直接丢掉，而不是在交给CPU去做进一步的处理，开启混杂模式，所有到达网卡的数据包不管目的地，全部都交给CPU做进一步的处理，这样包嗅探器都能抓到网络包了；
>现在的网卡大多数都支持混杂模式；


为什么要用Wireshark？

1. 支持1000+网络协议
2. 漂亮而又简单的UI
3. 开源软件，免费，强大的社区支持
4. 支持多种操作系统

 
Wireshark的由来：

> 1997年低，Gerald Combs需要一个能追踪网络数据包的软件来帮助他的工作，因此他开发了一个叫做Ethereal的工具（GPL），并在1998年发布， 到2006年的时候，Combs认为世界这么大，想出去看看，于是乎辞掉了他的工作去另一家公司就职，不幸的是因为商标纠纷的问题，Combs和其开发团队在2006年中旬将此醒目重新命名叫Wireshark。


#### 捕获你的第一个数据包

1 . 打开Wireshark，选择你要捕获的网络接口

![](https://raw.githubusercontent.com/oaas/wireshark/master/nic_chose.png)


2 . 尝试访问网站，你将看到下列页面

   * Wireshark主页面有三部分组成：捕获的数据包列表，指定包的详细信息，和指定包的原始二进制数据

![](https://raw.githubusercontent.com/oaas/wireshark/master/main_window.png)


#### Expert Information:

* Chat: 基本的通信信息
* Note: 不常见的包，有可能是正常的网络信息
  
  >TCP Retransimission: 由于包丢失的原因导致，当收到重复的ACK或重传计时器到期
  
  >Zero Window Probe: 监控TCP接受窗口的状态，通常在由于发送一个接受窗口为0的包出去
  
  >Keep Alive ACK: 发送一个keep-alive包的响应
  
  >Zero Window Probe ACK: 响应zero-window-probe的包
  
  >Window Is Full: 告知发送者，tcp接受窗口满了
  
  
   
* Warning: 不常见的数据包，有很大的可能不是正常的网络信息

>Previous Segment Lost: 表明数据包丢失，当一个期望的序列号在数据流中被跳过的时候发生
>ACKed Lost Packet: 在发现ACK的数据包不是期望的ACK包时产生
>Keep Alive： 当看到keep-alive包时出发
>Zero Window: 当接收者发送自己的tcp接受窗口为0是产生，告知发送者停止发送数据
>Out of Order: 通过序列号发现手机到的数据包是乱序时发生
>Fast Retransmission: 一个重传发生在重复ack的20毫秒 1
* Error： 包出现错误


##### TCP重传
TCP重传是TCP最基本的错误恢复功能之一，目的是为了防止数据包丢失；
数据包的丢失有很多中原因，比如应用出现问题，路由器的负载比较高，服务临时中断等。
主要的机器来决定是否需要重传一个数据包叫做重传计时器，计时器维护了一个叫做重传超时的值(RTO)。无论在什么时候，一个数据包通过TCP传输，重传计时器就开始，重传计时器停止当收到对应的ACK。从数据包发送到收到ACK之间的时间叫做往返时延。通常情况下根据RTT的值去调整RTO的值。
